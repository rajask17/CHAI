<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login | Chai Supreme</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        :root { --primary: #2c1810; --accent: #d4a373; }
        body {
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                        url('https://images.unsplash.com/photo-1544787210-22bb83063bd5?auto=format&fit=crop&w=1600&q=80');
            background-size: cover; height: 100vh; display: flex; align-items: center; justify-content: center;
            font-family: 'Poppins', sans-serif; color: white;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(15px);
            padding: 40px; border-radius: 20px; border: 1px solid rgba(212, 163, 115, 0.3);
            width: 100%; max-width: 400px; box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }
        .brand-logo { font-family: 'Marcellus', serif; color: var(--accent); letter-spacing: 2px; }
        .form-control {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(212, 163, 115, 0.2);
            color: white; padding: 12px; border-radius: 10px;
        }
        .form-control:focus { background: rgba(255, 255, 255, 0.2); border-color: var(--accent); color: white; box-shadow: none; }
        .btn-accent { background: var(--accent); color: #1a0f0a; font-weight: bold; border-radius: 50px; padding: 12px; width: 100%; transition: 0.3s; border: none; }
        .btn-accent:hover { background: #b88a5d; transform: translateY(-2px); }
        .modal-content { background: #1e1e1e; color: white; border: 1px solid var(--accent); }
    </style>
</head>
<body>

    <div class="login-card text-center">
        <div class="brand-logo h3 mb-4"><i class="fas fa-user-shield me-2"></i>ADMIN LOGIN</div>

        <form id="loginForm">
            <div class="text-start mb-3">
                <label class="small ms-2">Admin ID</label>
                <input type="text" id="adminId" class="form-control" placeholder="Enter ID" required>
            </div>
            <div class="text-start mb-1">
                <label class="small ms-2">Security PIN</label>
                <input type="password" id="adminPin" class="form-control" placeholder="****" required>
            </div>
            <div class="text-end mb-3">
                <a href="#" class="small text-accent text-decoration-none" data-bs-toggle="modal" data-bs-target="#forgotModal">Forgot Password?</a>
            </div>
            <button type="submit" class="btn-accent">UNLOCK DASHBOARD</button>
        </form>
        <a href="index.html" class="d-block mt-3 text-white-50 small text-decoration-none">← Back to Store</a>
    </div>

    <div class="modal fade" id="forgotModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-4">
                <div class="text-center" id="modalBody">
                    <h5 class="text-warning mb-3">FORGOT PASSWORD</h5>
                    
                    <div id="step1">
                        <p class="small opacity-75">OTP will be sent to: <br><strong>b2k****@gmail.com</strong></p>
                        <button class="btn btn-warning w-100 rounded-pill fw-bold mt-2" onclick="sendOTP()">SEND OTP TO MAIL</button>
                    </div>
                    
                    <div id="step2" style="display:none">
                        <p class="small text-success">Enter the OTP sent to your mail</p>
                        <input type="text" id="enteredOtp" class="form-control mb-3 text-center" placeholder="4-Digit OTP">
                        <button class="btn btn-success w-100 rounded-pill fw-bold" onclick="verifyOTP()">VERIFY OTP</button>
                    </div>

                    <div id="step3" style="display:none">
                        <p class="small text-info">Set New Admin Credentials</p>
                        <input type="text" id="newUsername" class="form-control mb-2" placeholder="New Admin ID">
                        <input type="password" id="newPassword" class="form-control mb-3" placeholder="New Security PIN">
                        <button class="btn btn-primary w-100 rounded-pill fw-bold" onclick="saveNewCredentials()">SAVE & LOGIN</button>
                    </div>

                    <div id="loader" style="display:none" class="mt-3">
                        <div class="spinner-border text-warning"></div>
                        <p class="small mt-2">Connecting to Mail Server...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (function() { emailjs.init("g0A1_hFuOOSvURTxs"); })();

        let generatedOTP;
        const ADMIN_MAIL = "b2kkings@gmail.com";

        // Login Logic
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('adminId').value;
            const pin = document.getElementById('adminPin').value;

            // Get saved credentials or use default
            const savedID = localStorage.getItem("admin_username") || "admin";
            const savedPin = localStorage.getItem("admin_password") || "1234";

            if(id === savedID && pin === savedPin) {
                sessionStorage.setItem("isLoggedIn", "true");
                window.location.href = "admin.html";
            } else {
                alert("❌ Invalid Credentials!");
            }
        });

        // 1. Send OTP
        function sendOTP() {
            document.getElementById('step1').style.display = 'none';
            document.getElementById('loader').style.display = 'block';

            generatedOTP = Math.floor(1000 + Math.random() * 9000);
            const expiryTime = new Date(new Date().getTime() + 15*60000).toLocaleTimeString();

            const params = { passcode: generatedOTP, time: expiryTime, to_email: ADMIN_MAIL };

            emailjs.send("service_abc123", "template_tmwc70c", params)
                .then(() => {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('step2').style.display = 'block';
                }, (err) => {
                    alert("Error: " + err.text);
                    document.getElementById('step1').style.display = 'block';
                    document.getElementById('loader').style.display = 'none';
                });
        }

        // 2. Verify OTP
        function verifyOTP() {
            if(document.getElementById('enteredOtp').value == generatedOTP) {
                document.getElementById('step2').style.display = 'none';
                document.getElementById('step3').style.display = 'block';
            } else {
                alert("❌ Wrong OTP!");
            }
        }

        // 3. Save New Credentials
        function saveNewCredentials() {
            const u = document.getElementById('newUsername').value;
            const p = document.getElementById('newPassword').value;

            if(u && p) {
                // SAVING NEW CREDENTIALS TO LOCALSTORAGE
                localStorage.setItem("admin_username", u);
                localStorage.setItem("admin_password", p);
                
                alert("✅ New Credentials Saved Successfully!");
                sessionStorage.setItem("isLoggedIn", "true");
                window.location.href = "admin.html";
            } else {
                alert("Please fill both fields!");
            }
        }
    </script>
</body>
</html>